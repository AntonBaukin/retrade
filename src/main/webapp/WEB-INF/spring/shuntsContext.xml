<?xml version = '1.0' encoding = 'UTF-8'?>

<beans xmlns          = 'http://www.springframework.org/schema/beans'
   xmlns:xsi          = 'http://www.w3.org/2001/XMLSchema-instance'
   xsi:schemaLocation = 'http://www.springframework.org/schema/beans
     http://www.springframework.org/schema/beans/spring-beans-3.0.xsd'>

  <!--=================================================
    =  Self Shunt Point                               =
    =================================================-->

  <bean name  = 'selfShuntPoint' factory-method = 'getInstance'
        class = 'com.tverts.shunts.SelfShuntPoint'>

    <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
     · The primary Self Shunt Service used by default.           ·
     · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
    <property name = 'service' ref = 'selfShuntService'/>

    <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
     · Makes all the shunt services to be active/inactive.       ·
     · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
    <property name = 'active' value = 'true'/>

    <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
     · Here all the shunts registered in the system are given    ·
     · to the implementation level set of shunts.                ·
     · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
    <property name = 'shuntsSet'>
      <bean class  = 'com.tverts.shunts.service.SelfShuntsRefsSet'>
        <property name = 'reference' ref = 'selfShuntsList'/>
      </bean>
    </property>
  </bean>


  <!--=================================================
    =  Self Shunts invocation protocols               =
    =================================================-->

  <import resource = 'shunts/shuntWhat.xml'/>


  <!--=================================================
    =  Self Shunts Protocols Collection               =
    +==================================================
    |
    |   The initial protocols to run always when the
    |   Shunt Service is activated.
    |
    +================================================-->

  <bean name  = 'selfShuntInitialTasks'
        class = 'com.tverts.shunts.SelfShuntWhats'>

    <property name  = 'references'>
      <list>

        <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
         · This collection of initial tasks invoked via HTTP.        ·
         · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
        <ref bean = 'selfShuntInitialTasksWeb'/>
      </list>
    </property>
  </bean>

  <!--=================================================
    =  Primary Self Shunt Service                     =
    =================================================-->

  <bean name  = 'selfShuntService'
        class = 'com.tverts.shunts.service.SelfShuntService'>

    <property name  = 'serviceName'
              value = 'selfShuntService'/>

    <property name  = 'serviceTitleEn'
              value = 'Primary Self Shunting Service'/>

    <property name  = 'serviceTitleLo'
              value = 'Основной Сервис самошунтирования'/>

    <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
     · Root dispatching handler of the shunt requests.           ·
     · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
    <property name = 'requestsHandler'>
      <bean class  = 'com.tverts.shunts.service.SeShRequestsDispatcher'>
        <property name = 'handlers'>
          <map>

            <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
             · Executes initial request to run all the shunt units.      ·
             · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
            <entry key = 'com.tverts.shunts.protocol.SeShRequestAll'>
              <bean class = 'com.tverts.shunts.service.SeShRequestAllHandler'/>
            </entry>

            <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
             · Executes initial request to the shunt units               ·
             · selected by the groups list.                              ·
             · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
            <entry key = 'com.tverts.shunts.protocol.SeShRequestGroups'>
              <bean class = 'com.tverts.shunts.service.SeShRequestGroupsHandler'/>
            </entry>

            <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
             · Executes initial request to the shunt unit(s)             ·
             · selected by the shunt name.                               ·
             · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
            <entry key = 'com.tverts.shunts.protocol.SeShRequestSingle'>
              <bean class = 'com.tverts.shunts.service.SeShRequestSingleHandler'/>
            </entry>

            <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
             · Executes request to run the next shunt of the sequence.   ·
             · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
            <entry key = 'com.tverts.shunts.protocol.SeShRequestsSequence'>
              <bean class = 'com.tverts.shunts.service.SeShRequestsSequenceHandler'/>
            </entry>
          </map>
        </property>
      </bean>
    </property>

    <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
     · The Shunt Protocols to always run in the service          ·
     · after it is activated.                                    ·
     · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
    <property name = 'initialTasks'
              ref  = 'selfShuntInitialTasks'/>

    <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
     · Logs shunt reports to 'com.tverts.shunts' destination.    ·
     · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
    <property name = 'reportConsumer'>
      <bean class  = 'com.tverts.shunts.reports.SeShReportLogger'/>
    </property>

    <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
     · Pauses to cooldown the service.                           ·
     · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
    <property name  = 'openPause'  value = '5000'/>
    <property name  = 'cyclePause' value = '500'/>
  </bean>


  <!--=================================================
    =  Self Shunt Filter for Web Shunt Service        =
    =================================================-->

  <bean name  = 'selfShuntFilter'
        class = 'com.tverts.shunts.protocol.SelfShuntFilter'>

    <property name = 'service' ref = 'selfShuntService'/>
  </bean>


  <!--=================================================
    =  External Self Shunts References                =
    =================================================-->

  <import resource = 'shunts/systemShunts.xml'/>
  <import resource = 'shunts/particularShunts.xml'/>


  <!--=================================================
    =  Self Shunts References                         =
    +==================================================
    |
    |   Here references to the shunts (also, shunt
    |   unit objects directly) are collected.
    |
    |   Note that it is possible to call subsets of
    |   shunts. This is based on shunt groups.
    |
    |   Do not register not system shunt units here:
    |   put them in 'particularShunts.xml' file.
    |
    +================================================-->

  <bean name  = 'selfShuntsList'
        class = 'com.tverts.shunts.SelfShuntsList'>
    <property name = 'references'>
      <list>
        <ref bean = 'systemShuntsList'/>
        <ref bean = 'particularShuntsList'/>
      </list>
    </property>
  </bean>
</beans>