<?xml version = '1.0' encoding = 'UTF-8'?>

<beans xmlns          = 'http://www.springframework.org/schema/beans'
   xmlns:xsi          = 'http://www.w3.org/2001/XMLSchema-instance'
   xsi:schemaLocation = 'http://www.springframework.org/schema/beans
     http://www.springframework.org/schema/beans/spring-beans-3.0.xsd'>


  <!--=================================================
    =  Self Shunts References                         =
    +================================================-->

  <import resource = 'shunts/shuntsList.xml'/>


  <!--=================================================
    =  Self Shunts Invocation Protocols               =
    =================================================-->

  <import resource = 'shunts/shuntWhat.xml'/>


  <!--=================================================
    =  Self Shunt Point                               =
    =================================================-->

  <bean name  = 'selfShuntPoint' factory-method = 'getInstance'
        class = 'com.tverts.shunts.SelfShuntPoint'>

    <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
     · The primary Self Shunt Service used by default.           ·
     · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
    <property name = 'service' ref = 'selfShuntService'/>

    <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
     · Here all the shunts registered in the system are given    ·
     · to the implementation level set of shunts.                ·
     · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
    <property name = 'shuntsSet'>
      <bean class  = 'com.tverts.shunts.service.SelfShuntsRefsSet'>
        <property name = 'reference' ref = 'selfShuntsList'/>
      </bean>
    </property>
  </bean>


  <!--=================================================
    =  Primary Self Shunt Service                     =
    =================================================-->

  <bean name  = 'selfShuntService'
        class = 'com.tverts.shunts.service.SelfShuntService'>

    <property name  = 'active' value = 'true'/>

    <property name  = 'serviceName'
              value = 'selfShuntService'/>

    <property name  = 'serviceTitleEn'
              value = 'Primary Self Shunting Service'/>

    <property name  = 'serviceTitleLo'
              value = 'Основной Сервис самошунтирования'/>

    <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
     · Root dispatching handler of the shunt requests.           ·
     · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
    <property name = 'requestsHandler'>
      <bean class  = 'com.tverts.shunts.service.SeShRequestsDispatcher'>
        <property name = 'handlers'>
          <map>

            <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
             · Executes initial request to run all the shunt units.      ·
             · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
            <entry key = 'com.tverts.shunts.protocol.SeShRequestAll'>
              <bean class = 'com.tverts.shunts.service.SeShRequestAllHandler'/>
            </entry>

            <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
             · Executes initial request to the shunt units               ·
             · selected by the groups list.                              ·
             · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
            <entry key = 'com.tverts.shunts.protocol.SeShRequestGroups'>
              <bean class = 'com.tverts.shunts.service.SeShRequestGroupsHandler'/>
            </entry>

            <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
             · Executes initial request to the shunt unit(s)             ·
             · selected by the shunt name.                               ·
             · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
            <entry key = 'com.tverts.shunts.protocol.SeShRequestSingle'>
              <bean class = 'com.tverts.shunts.service.SeShRequestSingleHandler'/>
            </entry>

            <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
             · Executes request to run the next shunt of the sequence.   ·
             · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
            <entry key = 'com.tverts.shunts.protocol.SeShRequestsSequence'>
              <bean class = 'com.tverts.shunts.service.SeShRequestsSequenceHandler'/>
            </entry>
          </map>
        </property>
      </bean>
    </property>

    <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
     · The Shunt Protocols to always run in the service          ·
     · after it is activated.                                    ·
     · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
    <property name = 'initialTasks'
              ref  = 'selfShuntInitialTasks'/>

    <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
     · Logs shunt reports to 'com.tverts.shunts' destination.    ·
     · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
    <property name = 'reportConsumer'>
      <bean class  = 'com.tverts.shunts.reports.SeShReportLogger'/>
    </property>


    <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
     · Synchronization point: wait Genesis Service completes.    ·
     · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
    <property name  = 'serviceSynch'
              ref   = 'selfShuntServiceSynch'/>

    <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
     · Pauses to cooldown the service.                           ·
     · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
    <property name  = 'openPause'  value = '5000'/>
    <property name  = 'cyclePause' value = '500'/>
  </bean>


  <bean name  = 'selfShuntServiceSynch'
        class = 'com.tverts.system.mp.ServiceWaitPointSynch'>

    <!-- · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
     · Means waiting for Genesis Service.                        ·
     · · · · · · · · · · · · · · · · · · · · · · · · · · · · · -->
    <property name = 'services'
              ref  = 'genesisService'/>
  </bean>


  <!--=================================================
    =  Self Shunt Filter for Web Shunt Service        =
    =================================================-->

  <bean name  = 'selfShuntFilter'
        class = 'com.tverts.shunts.protocol.SelfShuntFilter'>

    <property name = 'service' ref = 'selfShuntService'/>
  </bean>
</beans>