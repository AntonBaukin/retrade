<?xml version = '1.0' encoding = 'UTF-8'?>

<ui:fragment xmlns = 'http://www.w3.org/1999/xhtml'
   xmlns:ui = 'http://java.sun.com/jsf/facelets'
   xmlns:co = 'http://java.sun.com/jsf/composite'
   xmlns:z  = 'uri:tverts.com'>

  <co:interface>

    <co:attribute name = 'coid' required = 'true'
       type = 'java.lang.String'/>

    <co:attribute name = 'renderTo' default = ''
       type = 'java.lang.String'/>

    <co:facet name = 'extjs-props'/>

  </co:interface>

  <co:implementation>

    <div id = "#{cc.clientId}-#{cc.attrs.coid}-props" style = "display:none">
      <co:renderFacet name = "extjs-props"/>
    </div>

    <script type = "text/javascript">
    //<![CDATA[

  extjsf.defineBind('#{cc.attrs.coid}', '${rootView.extjsDomain}').
    nodeId('#{cc.clientId}-#{cc.attrs.coid}').
    renderTo("#{cc.attrs.renderTo}").
    extjsProps({xtype: 'panel', id: '#{cc.attrs.coid}'}).
    extjsPropsNode()

  if(!'#{cc.attrs.renderTo}'.length && '#{cc.parent.attrs.coid}'.length)
    extjsf.bindAddItem('#{cc.parent.attrs.coid}', '${rootView.extjsDomain}', '#{cc.attrs.coid}')

    //]]>
    </script>

    <co:insertChildren/>

    <script type = "text/javascript">

  if('#{cc.attrs.renderTo}'.length) Ext.onReady(function()
  {
    var bind = extjsf.bind('#{cc.attrs.coid}', '${rootView.extjsDomain}');

    function dodestroy()
    {
      var comp = bind.component();

      if(comp) try
      {
          comp.destroy()
      }
      finally
      {
          bind._component = undefined;
      }
    }

    //~: create the component
    bind.component(Ext.ComponentManager.create(bind.extjsProps()))

    //~: bind destroy listener
    extjsf.bind('#{cc.parent.attrs.coid}', '${rootView.extjsDomain}').
      on('beforedestroy', dodestroy)
  })

    </script>

  </co:implementation>
</ui:fragment>